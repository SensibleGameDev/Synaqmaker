{% extends "base.html" %}

{% block title %}Тесты для задачи "{{ task[1] }}"{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <a href="{{ url_for('tasks_list') }}" class="btn btn-sm btn-outline-secondary mb-2">
            <i class="bi bi-arrow-left"></i> К списку задач
        </a>
        <h2>Тесты для задачи "{{ task[1] }}"</h2>
    </div>
    <a href="{{ url_for('add_test', task_id=task[0]) }}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> Добавить тест вручную
    </a>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header">
        <i class="bi bi-file-earmark-spreadsheet-fill"></i> Импорт тестов из Excel
    </div>
    <div class="card-body">
        <p class="text-muted small">
            Загрузите .xlsx файл. Формат: <strong>Колонка 1</strong> - Входные данные, <strong>Колонка 2</strong> - Ожидаемый вывод. Без заголовков.
        </p>
        <form action="{{ url_for('import_tests_from_excel', task_id=task[0]) }}" method="POST" enctype="multipart/form-data" class="row g-3">
            <div class="col-md-6">
                <label for="tests_file" class="form-label">Файл Excel</label>
                <input class="form-control" type="file" id="tests_file" name="tests_file" accept=".xlsx,.xls" required>
            </div>
            <div class="col-md-4">
                <label for="time_limit_excel" class="form-label">Лимит времени (сек) для всех</label>
                <input type="number" step="0.1" class="form-control" id="time_limit_excel" name="time_limit_excel" value="1.0" required>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-success w-100">Импортировать</button>
            </div>
        </form>
    </div>
</div>
<div class="card shadow-sm">
    <div class="card-header">
        <i class="bi bi-card-checklist"></i> Существующие тесты
    </div>
    <div class="card-body">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Входные данные</th>
                    <th scope="col">Ожидаемый вывод</th>
                    <th scope="col">Лимит (сек)</th>
                    <th scope="col" class="text-end">Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for test in tests %}
                <tr>
                    <th scope="row">{{ test[0] }}</th>
                    <td><pre class="mb-0 code-area">{{ test[1] }}</pre></td>
                    <td><pre class="mb-0 code-area">{{ test[2] }}</pre></td>
                    <td>{{ test[3] }}</td>
                    <td class="text-end">
                        <a href="{{ url_for('edit_test', task_id=task[0], test_id=test[0]) }}" class="btn btn-sm btn-outline-primary me-1" title="Редактировать">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <form action="{{ url_for('delete_test', task_id=task[0], test_id=test[0]) }}" method="post" class="d-inline" onsubmit="return confirm('Вы уверены, что хотите удалить этот тест?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Удалить">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center text-muted">Тестов для этой задачи пока нет.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}